<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../../WEB-INF/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html">

    <ui:define name="content">
        <h:form id="formView">
            <p:poll id="poll" interval="180" listener="#{examCallBean.reset()}" autoStart="true"
                    process="@this" update="panelView,callState" oncomplete="call();"/>
            <p:panel id="panelView">
                <p:dataGrid id="plgView" value="#{examCallBean.model}" var="item" layout="grid" paginator="false" rows="8"  columns="4" lazy="true">
                    <p:column>
                        <div class="Card GreenBack">
                            <div class="CardTopic White Fs22">
                                <h:outputText value="#{item.formid}"/><i class="icon-pin-outline Fright White Opac50 Fs20"></i>
                            </div>
                            <div class="EmptyBox5"></div>
                            <div class="Container100 NoIndent White Fs40">
                                <h:outputText value="#{item.name}"/><p:commandButton id="btnCall" value="呼叫" actionListener="#{examCallBean.call(item)}" styleClass="GreenButton" 
                                                                                     process="@this" update="formView:panelCall"/>
                            </div>
                            <div class="EmptyBox5"></div>
                            <div class="Container100 NoIndent Fs20">
                                <h:outputText value="#{item.idcard}"/>
                            </div>
                            <div class="EmptyBox5"></div>
                        </div>
                    </p:column>
                </p:dataGrid>
            </p:panel>
            <p:panel id="panelCall" style="display: none;">
                <video id="video" controls="" autoplay="true" name="media" style="display: none;">
                    <source id="ttsAudio" src="#{examCallBean.audio}" type="audio/mp3"/>
                </video>              
            </p:panel>            
            <p:poll id="call" interval="10" listener="#{examCallBean.call()}" autoStart="true" stop="#{examCallBean.stop}"
                    process="@this" update="@this,callState,panelCall" widgetVar="call" />
            <p:inputText id="callState" type="hidden"  value="#{examCallBean.stop}"/> 
        </h:form>
        <script>
            $(function () {
                $('body').addClass('PopupMenu');
            });
            var call = function () {
                var s = $(document.getElementById('formView:callState')).val();
                if (s === 'false') {
                    //恢复启动
                    PF('call').start();
                }
            };
        </script>
    </ui:define>

</ui:composition>
